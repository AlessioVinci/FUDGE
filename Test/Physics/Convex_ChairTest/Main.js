"use strict";
var FudgeExperiments_Marko_ConvexColliderThroughWelding;
(function (FudgeExperiments_Marko_ConvexColliderThroughWelding) {
    var f = FudgeCore;
    // In a Test there could be about 100 Chairs and still maintain 15+ FPS, resulting in 600 RB's and 500 Joints calculated per Frame.
    //Fudge Basic Variables
    window.addEventListener("load", init);
    const app = document.querySelector("canvas"); // The html element where the scene is drawn to
    let viewPort; // The scene visualization
    let hierarchy; // You're object scene tree
    let fps;
    const times = [];
    let fpsDisplay = document.querySelector("h2#FPS");
    //Physical Objects
    let bodies = new Array(); // Array of all physical objects in the scene to have a quick reference
    let noChairs = 0;
    //Setting Variables
    //Function to initialize the Fudge Scene with a camera, light, viewport and PHYSCIAL Objects
    function init(_event) {
        hierarchy = new f.Node("Scene"); //create the root Node where every object is parented to. Should never be changed
        //PHYSICS - Basic Plane and Cube
        //Creating a physically static ground plane for our physics playground. A simple scaled cube but with physics type set to static
        bodies[0] = createCompleteNode("Ground", new f.Material("Ground", f.ShaderFlat, new f.CoatColored(new f.Color(0.2, 0.2, 0.2, 1))), new f.MeshCube(), 0, f.BODY_TYPE.STATIC);
        bodies[0].mtxLocal.scale(new f.Vector3(14, 0.3, 14)); //Scale the body with it's standard ComponentTransform
        bodies[0].mtxLocal.rotateX(3, true); //Give it a slight rotation so the physical objects are sliding, always from left when it's after a scaling
        hierarchy.appendChild(bodies[0]); //Add the node to the scene by adding it to the scene-root
        spawnChair();
        //Standard Fudge Scene Initialization - Creating a directional light, a camera and initialize the viewport
        let cmpLight = new f.ComponentLight(new f.LightDirectional(f.Color.CSS("WHITE")));
        cmpLight.mtxPivot.lookAt(new f.Vector3(0.5, -1, -0.8)); //Set light direction
        hierarchy.addComponent(cmpLight);
        let cmpCamera = new f.ComponentCamera();
        cmpCamera.clrBackground = f.Color.CSS("GREY");
        cmpCamera.mtxPivot.translate(new f.Vector3(2, 3.5, 17)); //Move camera far back so the whole scene is visible
        cmpCamera.mtxPivot.lookAt(f.Vector3.ZERO()); //Set the camera matrix so that it looks at the center of the scene
        viewPort = new f.Viewport(); //Creating a viewport that is rendered onto the html canvas element
        viewPort.initialize("Viewport", hierarchy, cmpCamera, app); //initialize the viewport with the root node, camera and canvas
        // viewPort.physicsDebugMode = f.PHYSICS_DEBUGMODE.JOINTS_AND_COLLIDER;
        //PHYSICS - Start using physics by telling the physics the scene root object. Physics will recalculate every transform and initialize
        f.Physics.adjustTransforms(hierarchy);
        app.addEventListener("mousedown", () => { spawnChair(); });
        //Important start the game loop after starting physics, so physics can use the current transform before it's first iteration
        f.Loop.addEventListener("loopFrame" /* LOOP_FRAME */, update); //Tell the game loop to call the update function on each frame
        f.Loop.start(); //Stard the game loop
    }
    //Function to animate/update the Fudge scene, commonly known as gameloop
    function update() {
        f.Physics.world.simulate(); //PHYSICS - Simulate physical changes each frame, parameter to set time between frames
        measureFPS();
        viewPort.draw(); // Draw the current Fudge Scene to the canvas
    }
    // Function to quickly create a node with multiple needed FudgeComponents, including a physics component
    function createCompleteNode(_name, _material, _mesh, _mass, _physicsType, _group = f.COLLISION_GROUP.DEFAULT, _colType = f.COLLIDER_TYPE.CUBE) {
        //Standard Fudge Node Creation
        let node = new f.Node(_name); //Creating the node
        let cmpMesh = new f.ComponentMesh(_mesh); //Creating a mesh for the node
        let cmpMaterial = new f.ComponentMaterial(_material); //Creating a material for the node
        let cmpTransform = new f.ComponentTransform(); //Transform holding position/rotation/scaling of the node
        let cmpRigidbody = new f.ComponentRigidbody(_mass, _physicsType, _colType, _group); //Adding a physical body component to use physics
        node.addComponent(cmpMesh);
        node.addComponent(cmpMaterial);
        node.addComponent(cmpTransform);
        node.addComponent(cmpRigidbody); // <-- best practice to add physics component last
        return node;
    }
    function spawnChair() {
        let rngHeight = (min, max) => {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        };
        let spawnHeight = rngHeight(8, 20);
        noChairs++;
        //Creating a chair, base + back + 4 legs
        let base = createCompleteNode("Base", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.75, 0.8, 0.75, 1))), new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC);
        base.mtxLocal.translate(new f.Vector3(0, 3.5 + spawnHeight, 0));
        base.mtxLocal.scale(new f.Vector3(1, 0.2, 1));
        hierarchy.appendChild(base);
        let back = createCompleteNode("Back", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.75, 0.8, 0.75, 1))), new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC);
        back.mtxLocal.translate(new f.Vector3(0.4, 4 + spawnHeight, 0));
        back.mtxLocal.scale(new f.Vector3(0.2, 1, 1));
        hierarchy.appendChild(back);
        let weldingJoint = new f.JointWelding(base.getComponent(f.ComponentRigidbody), back.getComponent(f.ComponentRigidbody));
        back.addComponent(weldingJoint);
        let leg = createCompleteNode("Leg_BL", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.75, 0.8, 0.75, 1))), new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC, f.COLLISION_GROUP.GROUP_2);
        leg.mtxLocal.translate(new f.Vector3(0.4, 3 + spawnHeight, 0.4));
        leg.mtxLocal.scale(new f.Vector3(0.2, 0.8, 0.2));
        hierarchy.appendChild(leg);
        weldingJoint = new f.JointWelding(base.getComponent(f.ComponentRigidbody), leg.getComponent(f.ComponentRigidbody));
        back.addComponent(weldingJoint);
        leg = createCompleteNode("Leg_BR", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.75, 0.8, 0.75, 1))), new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC, f.COLLISION_GROUP.GROUP_2);
        leg.mtxLocal.translate(new f.Vector3(0.4, 3 + spawnHeight, -0.4));
        leg.mtxLocal.scale(new f.Vector3(0.2, 0.8, 0.2));
        hierarchy.appendChild(leg);
        weldingJoint = new f.JointWelding(base.getComponent(f.ComponentRigidbody), leg.getComponent(f.ComponentRigidbody));
        back.addComponent(weldingJoint);
        leg = createCompleteNode("Leg_FR", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.75, 0.8, 0.75, 1))), new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC, f.COLLISION_GROUP.GROUP_2);
        leg.mtxLocal.translate(new f.Vector3(-0.4, 3 + spawnHeight, -0.4));
        leg.mtxLocal.scale(new f.Vector3(0.2, 0.8, 0.2));
        hierarchy.appendChild(leg);
        weldingJoint = new f.JointWelding(base.getComponent(f.ComponentRigidbody), leg.getComponent(f.ComponentRigidbody));
        back.addComponent(weldingJoint);
        leg = createCompleteNode("Leg_FR", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.75, 0.8, 0.75, 1))), new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC, f.COLLISION_GROUP.GROUP_2);
        leg.mtxLocal.translate(new f.Vector3(-0.4, 3 + spawnHeight, 0.4));
        leg.mtxLocal.scale(new f.Vector3(0.2, 0.8, 0.2));
        hierarchy.appendChild(leg);
        weldingJoint = new f.JointWelding(base.getComponent(f.ComponentRigidbody), leg.getComponent(f.ComponentRigidbody));
        back.addComponent(weldingJoint);
        f.Physics.adjustTransforms(hierarchy); // Important! You need to at least adjust Transforms for the parts of the chair
    }
    function measureFPS() {
        window.requestAnimationFrame(() => {
            const now = performance.now();
            while (times.length > 0 && times[0] <= now - 1000) {
                times.shift();
            }
            times.push(now);
            fps = times.length;
            fpsDisplay.textContent = `FPS: ${fps.toString()} / Chairs: ${noChairs} / Bodies: ${f.Physics.world.getBodyList().length}`;
        });
    }
})(FudgeExperiments_Marko_ConvexColliderThroughWelding || (FudgeExperiments_Marko_ConvexColliderThroughWelding = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQVUsbURBQW1ELENBd0o1RDtBQXhKRCxXQUFVLG1EQUFtRDtJQUMzRCxJQUFPLENBQUMsR0FBRyxTQUFTLENBQUM7SUFFckIsbUlBQW1JO0lBRW5JLHVCQUF1QjtJQUN2QixNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sR0FBRyxHQUFzQixRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsK0NBQStDO0lBQ2hILElBQUksUUFBb0IsQ0FBQyxDQUFDLDBCQUEwQjtJQUNwRCxJQUFJLFNBQWlCLENBQUMsQ0FBQywyQkFBMkI7SUFDbEQsSUFBSSxHQUFXLENBQUM7SUFDaEIsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO0lBQzNCLElBQUksVUFBVSxHQUFnQixRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBRy9ELGtCQUFrQjtJQUNsQixJQUFJLE1BQU0sR0FBYSxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsdUVBQXVFO0lBQzNHLElBQUksUUFBUSxHQUFXLENBQUMsQ0FBQztJQUV6QixtQkFBbUI7SUFJbkIsNEZBQTRGO0lBQzVGLFNBQVMsSUFBSSxDQUFDLE1BQWE7UUFFekIsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGlGQUFpRjtRQUVsSCxnQ0FBZ0M7UUFDaEMsZ0lBQWdJO1FBQ2hJLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFF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QUFDLEdBQUcsR0FBRyxDQUFDO1FBQzNELENBQUMsQ0FBQztRQUNGLElBQUksV0FBVyxHQUFXLFNBQVMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0MsUUFBUSxFQUFFLENBQUM7UUFFWCx3Q0FBd0M7UUFDeEMsSUFBSSxJQUFJLEdBQVcsa0JBQWtCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsTCxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBRyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlDLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFNUIsSUFBSSxJQUFJLEdBQVcsa0JBQWtCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FB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Q0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN0QyxPQUFPLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLEdBQUcsSUFBSSxFQUFFO2dCQUNqRCxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDZjtZQUNELEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDaEIsR0FBRyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7WUFDbkIsVUFBVSxDQUFDLFdBQVcsR0FBRyxRQUFRLEdBQUcsQ0FBQyxRQUFRLEVBQUUsY0FBYyxRQUFRLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDNUgsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0FBR0gsQ0FBQyxFQXhKUyxtREFBbUQsS0FBbkQsbURBQW1ELFFBd0o1RCIsInNvdXJjZXNDb250ZW50IjpbIm5hbWVzcGFjZSBGdWRnZUV4cGVyaW1lbnRzX01hcmtvX0NvbnZleENvbGxpZGVyVGhyb3VnaFdlbGRpbmcge1xyXG4gIGltcG9ydCBmID0gRnVkZ2VDb3JlO1xyXG5cclxuICAvLyBJbiBhIFRlc3QgdGhlcmUgY291bGQgYmUgYWJvdXQgMTAwIENoYWlycyBhbmQgc3RpbGwgbWFpbnRhaW4gMTUrIEZQUywgcmVzdWx0aW5nIGluIDYwMCBSQidzIGFuZCA1MDAgSm9pbnRzIGNhbGN1bGF0ZWQgcGVyIEZyYW1lLlxyXG5cclxuICAvL0Z1ZGdlIEJhc2ljIFZhcmlhYmxlc1xyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBpbml0KTtcclxuICBjb25zdCBhcHA6IEhUTUxDYW52YXNFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTsgLy8gVGhlIGh0bWwgZWxlbWVudCB3aGVyZSB0aGUgc2NlbmUgaXMgZHJhd24gdG9cclxuICBsZXQgdmlld1BvcnQ6IGYuVmlld3BvcnQ7IC8vIFRoZSBzY2VuZSB2aXN1YWxpemF0aW9uXHJcbiAgbGV0IGhpZXJhcmNoeTogZi5Ob2RlOyAvLyBZb3UncmUgb2JqZWN0IHNjZW5lIHRyZWVcclxuICBsZXQgZnBzOiBudW1iZXI7XHJcbiAgY29uc3QgdGltZXM6IG51bWJlcltdID0gW107XHJcbiAgbGV0IGZwc0Rpc3BsYXk6IEhUTUxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImgyI0ZQU1wiKTtcclxuXHJcblxyXG4gIC8vUGh5c2ljYWwgT2JqZWN0c1xyXG4gIGxldCBib2RpZXM6IGYuTm9kZVtdID0gbmV3IEFycmF5KCk7IC8vIEFycmF5IG9mIGFsbCBwaHlzaWNhbCBvYmplY3RzIGluIHRoZSBzY2VuZSB0byBoYXZlIGEgcXVpY2sgcmVmZXJlbmNlXHJcbiAgbGV0IG5vQ2hhaXJzOiBudW1iZXIgPSAwO1xyXG5cclxuICAvL1NldHRpbmcgVmFyaWFibGVzXHJcblxyXG5cclxuXHJcbiAgLy9GdW5jdGlvbiB0byBpbml0aWFsaXplIHRoZSBGdWRnZSBTY2VuZSB3aXRoIGEgY2FtZXJhLCBsaWdodCwgdmlld3BvcnQgYW5kIFBIWVNDSUFMIE9iamVjdHNcclxuICBmdW5jdGlvbiBpbml0KF9ldmVudDogRXZlbnQpOiB2b2lkIHtcclxuXHJcbiAgICBoaWVyYXJjaHkgPSBuZXcgZi5Ob2RlKFwiU2NlbmVcIik7IC8vY3JlYXRlIHRoZSByb290IE5vZGUgd2hlcmUgZXZlcnkgb2JqZWN0IGlzIHBhcmVudGVkIHRvLiBTaG91bGQgbmV2ZXIgYmUgY2hhbmdlZFxyXG5cclxuICAgIC8vUEhZU0lDUyAtIEJhc2ljIFBsYW5lIGFuZCBDdWJlXHJcbiAgICAvL0NyZWF0aW5nIGEgcGh5c2ljYWxseSBzdGF0aWMgZ3JvdW5kIHBsYW5lIGZvciBvdXIgcGh5c2ljcyBwbGF5Z3JvdW5kLiBBIHNpbXBsZSBzY2FsZWQgY3ViZSBidXQgd2l0aCBwaHlzaWNzIHR5cGUgc2V0IHRvIHN0YXRpY1xyXG4gICAgYm9kaWVzWzBdID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiR3JvdW5kXCIsIG5ldyBmLk1hdGVyaWFsKFwiR3JvdW5kXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC4yLCAwLjIsIDAuMiwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMCwgZi5CT0RZX1RZUEUuU1RBVElDKTtcclxuICAgIGJvZGllc1swXS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDE0LCAwLjMsIDE0KSk7IC8vU2NhbGUgdGhlIGJvZHkgd2l0aCBpdCdzIHN0YW5kYXJkIENvbXBvbmVudFRyYW5zZm9ybVxyXG4gICAgYm9kaWVzWzBdLm10eExvY2FsLnJvdGF0ZVgoMywgdHJ1ZSk7IC8vR2l2ZSBpdCBhIHNsaWdodCByb3RhdGlvbiBzbyB0aGUgcGh5c2ljYWwgb2JqZWN0cyBhcmUgc2xpZGluZywgYWx3YXlzIGZyb20gbGVmdCB3aGVuIGl0J3MgYWZ0ZXIgYSBzY2FsaW5nXHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzBdKTsgLy9BZGQgdGhlIG5vZGUgdG8gdGhlIHNjZW5lIGJ5IGFkZGluZyBpdCB0byB0aGUgc2NlbmUtcm9vdFxyXG5cclxuICAgIHNwYXduQ2hhaXIoKTtcclxuXHJcbiAgICAvL1N0YW5kYXJkIEZ1ZGdlIFNjZW5lIEluaXRpYWxpemF0aW9uIC0gQ3JlYXRpbmcgYSBkaXJlY3Rpb25hbCBsaWdodCwgYSBjYW1lcmEgYW5kIGluaXRpYWxpemUgdGhlIHZpZXdwb3J0XHJcbiAgICBsZXQgY21wTGlnaHQ6IGYuQ29tcG9uZW50TGlnaHQgPSBuZXcgZi5Db21wb25lbnRMaWdodChuZXcgZi5MaWdodERpcmVjdGlvbmFsKGYuQ29sb3IuQ1NTKFwiV0hJVEVcIikpKTtcclxuICAgIGNtcExpZ2h0Lm10eFBpdm90Lmxvb2tBdChuZXcgZi5WZWN0b3IzKDAuNSwgLTEsIC0wLjgpKTsgLy9TZXQgbGlnaHQgZGlyZWN0aW9uXHJcbiAgICBoaWVyYXJjaHkuYWRkQ29tcG9uZW50KGNtcExpZ2h0KTtcclxuXHJcbiAgICBsZXQgY21wQ2FtZXJhOiBmLkNvbXBvbmVudENhbWVyYSA9IG5ldyBmLkNvbXBvbmVudENhbWVyYSgpO1xyXG4gICAgY21wQ2FtZXJhLmNsckJhY2tncm91bmQgPSBmLkNvbG9yLkNTUyhcIkdSRVlcIik7XHJcbiAgICBjbXBDYW1lcmEubXR4UGl2b3QudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMiwgMy41LCAxNykpOyAvL01vdmUgY2FtZXJhIGZhciBiYWNrIHNvIHRoZSB3aG9sZSBzY2VuZSBpcyB2aXNpYmxlXHJcbiAgICBjbXBDYW1lcmEubXR4UGl2b3QubG9va0F0KGYuVmVjdG9yMy5aRVJPKCkpOyAvL1NldCB0aGUgY2FtZXJhIG1hdHJpeCBzbyB0aGF0IGl0IGxvb2tzIGF0IHRoZSBjZW50ZXIgb2YgdGhlIHNjZW5lXHJcblxyXG4gICAgdmlld1BvcnQgPSBuZXcgZi5WaWV3cG9ydCgpOyAvL0NyZWF0aW5nIGEgdmlld3BvcnQgdGhhdCBpcyByZW5kZXJlZCBvbnRvIHRoZSBodG1sIGNhbnZhcyBlbGVtZW50XHJcbiAgICB2aWV3UG9ydC5pbml0aWFsaXplKFwiVmlld3BvcnRcIiwgaGllcmFyY2h5LCBjbXBDYW1lcmEsIGFwcCk7IC8vaW5pdGlhbGl6ZSB0aGUgdmlld3BvcnQgd2l0aCB0aGUgcm9vdCBub2RlLCBjYW1lcmEgYW5kIGNhbnZhc1xyXG4gICAgLy8gdmlld1BvcnQucGh5c2ljc0RlYnVnTW9kZSA9IGYuUEhZU0lDU19ERUJVR01PREUuSk9JTlRTX0FORF9DT0xMSURFUjtcclxuXHJcbiAgICAvL1BIWVNJQ1MgLSBTdGFydCB1c2luZyBwaHlzaWNzIGJ5IHRlbGxpbmcgdGhlIHBoeXNpY3MgdGhlIHNjZW5lIHJvb3Qgb2JqZWN0LiBQaHlzaWNzIHdpbGwgcmVjYWxjdWxhdGUgZXZlcnkgdHJhbnNmb3JtIGFuZCBpbml0aWFsaXplXHJcbiAgICBmLlBoeXNpY3MuYWRqdXN0VHJhbnNmb3JtcyhoaWVyYXJjaHkpO1xyXG4gICAgYXBwLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKCkgPT4geyBzcGF3bkNoYWlyKCk7IH0pO1xyXG5cclxuICAgIC8vSW1wb3J0YW50IHN0YXJ0IHRoZSBnYW1lIGxvb3AgYWZ0ZXIgc3RhcnRpbmcgcGh5c2ljcywgc28gcGh5c2ljcyBjYW4gdXNlIHRoZSBjdXJyZW50IHRyYW5zZm9ybSBiZWZvcmUgaXQncyBmaXJzdCBpdGVyYXRpb25cclxuICAgIGYuTG9vcC5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlQuTE9PUF9GUkFNRSwgdXBkYXRlKTsgLy9UZWxsIHRoZSBnYW1lIGxvb3AgdG8gY2FsbCB0aGUgdXBkYXRlIGZ1bmN0aW9uIG9uIGVhY2ggZnJhbWVcclxuICAgIGYuTG9vcC5zdGFydCgpOyAvL1N0YXJkIHRoZSBnYW1lIGxvb3BcclxuICB9XHJcblxyXG4gIC8vRnVuY3Rpb24gdG8gYW5pbWF0ZS91cGRhdGUgdGhlIEZ1ZGdlIHNjZW5lLCBjb21tb25seSBrbm93biBhcyBnYW1lbG9vcFxyXG4gIGZ1bmN0aW9uIHVwZGF0ZSgpOiB2b2lkIHtcclxuICAgIGYuUGh5c2ljcy53b3JsZC5zaW11bGF0ZSgpOyAvL1BIWVNJQ1MgLSBTaW11bGF0ZSBwaHlzaWNhbCBjaGFuZ2VzIGVhY2ggZnJhbWUsIHBhcmFtZXRlciB0byBzZXQgdGltZSBiZXR3ZWVuIGZyYW1lc1xyXG4gICAgbWVhc3VyZUZQUygpO1xyXG4gICAgdmlld1BvcnQuZHJhdygpOyAvLyBEcmF3IHRoZSBjdXJyZW50IEZ1ZGdlIFNjZW5lIHRvIHRoZSBjYW52YXNcclxuICB9XHJcblxyXG4gIC8vIEZ1bmN0aW9uIHRvIHF1aWNrbHkgY3JlYXRlIGEgbm9kZSB3aXRoIG11bHRpcGxlIG5lZWRlZCBGdWRnZUNvbXBvbmVudHMsIGluY2x1ZGluZyBhIHBoeXNpY3MgY29tcG9uZW50XHJcbiAgZnVuY3Rpb24gY3JlYXRlQ29tcGxldGVOb2RlKF9uYW1lOiBzdHJpbmcsIF9tYXRlcmlhbDogZi5NYXRlcmlhbCwgX21lc2g6IGYuTWVzaCwgX21hc3M6IG51bWJlciwgX3BoeXNpY3NUeXBlOiBmLkJPRFlfVFlQRSwgX2dyb3VwOiBmLkNPTExJU0lPTl9HUk9VUCA9IGYuQ09MTElTSU9OX0dST1VQLkRFRkFVTFQsIF9jb2xUeXBlOiBmLkNPTExJREVSX1RZUEUgPSBmLkNPTExJREVSX1RZUEUuQ1VCRSk6IGYuTm9kZSB7XHJcbiAgICAvL1N0YW5kYXJkIEZ1ZGdlIE5vZGUgQ3JlYXRpb25cclxuICAgIGxldCBub2RlOiBmLk5vZGUgPSBuZXcgZi5Ob2RlKF9uYW1lKTsgLy9DcmVhdGluZyB0aGUgbm9kZVxyXG4gICAgbGV0IGNtcE1lc2g6IGYuQ29tcG9uZW50TWVzaCA9IG5ldyBmLkNvbXBvbmVudE1lc2goX21lc2gpOyAvL0NyZWF0aW5nIGEgbWVzaCBmb3IgdGhlIG5vZGVcclxuICAgIGxldCBjbXBNYXRlcmlhbDogZi5Db21wb25lbnRNYXRlcmlhbCA9IG5ldyBmLkNvbXBvbmVudE1hdGVyaWFsKF9tYXRlcmlhbCk7IC8vQ3JlYXRpbmcgYSBtYXRlcmlhbCBmb3IgdGhlIG5vZGVcclxuICAgIGxldCBjbXBUcmFuc2Zvcm06IGYuQ29tcG9uZW50VHJhbnNmb3JtID0gbmV3IGYuQ29tcG9uZW50VHJhbnNmb3JtKCk7ICAvL1RyYW5zZm9ybSBob2xkaW5nIHBvc2l0aW9uL3JvdGF0aW9uL3NjYWxpbmcgb2YgdGhlIG5vZGVcclxuICAgIGxldCBjbXBSaWdpZGJvZHk6IGYuQ29tcG9uZW50UmlnaWRib2R5ID0gbmV3IGYuQ29tcG9uZW50UmlnaWRib2R5KF9tYXNzLCBfcGh5c2ljc1R5cGUsIF9jb2xUeXBlLCBfZ3JvdXApOyAvL0FkZGluZyBhIHBoeXNpY2FsIGJvZHkgY29tcG9uZW50IHRvIHVzZSBwaHlzaWNzXHJcblxyXG4gICAgbm9kZS5hZGRDb21wb25lbnQoY21wTWVzaCk7XHJcbiAgICBub2RlLmFkZENvbXBvbmVudChjbXBNYXRlcmlhbCk7XHJcbiAgICBub2RlLmFkZENvbXBvbmVudChjbXBUcmFuc2Zvcm0pO1xyXG4gICAgbm9kZS5hZGRDb21wb25lbnQoY21wUmlnaWRib2R5KTsgLy8gPC0tIGJlc3QgcHJhY3RpY2UgdG8gYWRkIHBoeXNpY3MgY29tcG9uZW50IGxhc3RcclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc3Bhd25DaGFpcigpOiB2b2lkIHtcclxuICAgIGxldCBybmdIZWlnaHQ6IEZ1bmN0aW9uID0gKG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcikgPT4ge1xyXG4gICAgICBtaW4gPSBNYXRoLmNlaWwobWluKTtcclxuICAgICAgbWF4ID0gTWF0aC5mbG9vcihtYXgpO1xyXG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxuICAgIH07XHJcbiAgICBsZXQgc3Bhd25IZWlnaHQ6IG51bWJlciA9IHJuZ0hlaWdodCg4LCAyMCk7XHJcbiAgICBub0NoYWlycysrO1xyXG5cclxuICAgIC8vQ3JlYXRpbmcgYSBjaGFpciwgYmFzZSArIGJhY2sgKyA0IGxlZ3NcclxuICAgIGxldCBiYXNlOiBmLk5vZGUgPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJCYXNlXCIsIG5ldyBmLk1hdGVyaWFsKFwiQ3ViZVwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRDb2xvcmVkKG5ldyBmLkNvbG9yKDAuNzUsIDAuOCwgMC43NSwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5CT0RZX1RZUEUuRFlOQU1JQyk7XHJcbiAgICBiYXNlLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDAsIDMuNSArIHNwYXduSGVpZ2h0LCAwKSk7XHJcbiAgICBiYXNlLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMSwgMC4yLCAxKSk7XHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYmFzZSk7XHJcblxyXG4gICAgbGV0IGJhY2s6IGYuTm9kZSA9IGNyZWF0ZUNvbXBsZXRlTm9kZShcIkJhY2tcIiwgbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC43NSwgMC44LCAwLjc1LCAxKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLkJPRFlfVFlQRS5EWU5BTUlDKTtcclxuICAgIGJhY2subXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMC40LCA0ICsgc3Bhd25IZWlnaHQsIDApKTtcclxuICAgIGJhY2subXR4TG9jYWwuc2NhbGUobmV3IGYuVmVjdG9yMygwLjIsIDEsIDEpKTtcclxuICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChiYWNrKTtcclxuICAgIGxldCB3ZWxkaW5nSm9pbnQ6IGYuSm9pbnRXZWxkaW5nID0gbmV3IGYuSm9pbnRXZWxkaW5nKGJhc2UuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KSwgYmFjay5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpKTtcclxuICAgIGJhY2suYWRkQ29tcG9uZW50KHdlbGRpbmdKb2ludCk7XHJcblxyXG4gICAgbGV0IGxlZzogZi5Ob2RlID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiTGVnX0JMXCIsIG5ldyBmLk1hdGVyaWFsKFwiQ3ViZVwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRDb2xvcmVkKG5ldyBmLkNvbG9yKDAuNzUsIDAuOCwgMC43NSwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5CT0RZX1RZUEUuRFlOQU1JQywgZi5DT0xMSVNJT05fR1JPVVAuR1JPVVBfMik7XHJcbiAgICBsZWcubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMC40LCAzICsgc3Bhd25IZWlnaHQsIDAuNCkpO1xyXG4gICAgbGVnLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMC4yLCAwLjgsIDAuMikpO1xyXG4gICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGxlZyk7XHJcblxyXG4gICAgd2VsZGluZ0pvaW50ID0gbmV3IGYuSm9pbnRXZWxkaW5nKGJhc2UuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KSwgbGVnLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkpO1xyXG4gICAgYmFjay5hZGRDb21wb25lbnQod2VsZGluZ0pvaW50KTtcclxuXHJcbiAgICBsZWcgPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJMZWdfQlJcIiwgbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC43NSwgMC44LCAwLjc1LCAxKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLkJPRFlfVFlQRS5EWU5BTUlDLCBmLkNPTExJU0lPTl9HUk9VUC5HUk9VUF8yKTtcclxuICAgIGxlZy5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygwLjQsIDMgKyBzcGF3bkhlaWdodCwgLTAuNCkpO1xyXG4gICAgbGVnLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMC4yLCAwLjgsIDAuMikpO1xyXG4gICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGxlZyk7XHJcblxyXG4gICAgd2VsZGluZ0pvaW50ID0gbmV3IGYuSm9pbnRXZWxkaW5nKGJhc2UuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KSwgbGVnLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkpO1xyXG4gICAgYmFjay5hZGRDb21wb25lbnQod2VsZGluZ0pvaW50KTtcclxuXHJcbiAgICBsZWcgPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJMZWdfRlJcIiwgbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC43NSwgMC44LCAwLjc1LCAxKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLkJPRFlfVFlQRS5EWU5BTUlDLCBmLkNPTExJU0lPTl9HUk9VUC5HUk9VUF8yKTtcclxuICAgIGxlZy5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygtMC40LCAzICsgc3Bhd25IZWlnaHQsIC0wLjQpKTtcclxuICAgIGxlZy5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDAuMiwgMC44LCAwLjIpKTtcclxuICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChsZWcpO1xyXG5cclxuICAgIHdlbGRpbmdKb2ludCA9IG5ldyBmLkpvaW50V2VsZGluZyhiYXNlLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSksIGxlZy5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpKTtcclxuICAgIGJhY2suYWRkQ29tcG9uZW50KHdlbGRpbmdKb2ludCk7XHJcblxyXG4gICAgbGVnID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiTGVnX0ZSXCIsIG5ldyBmLk1hdGVyaWFsKFwiQ3ViZVwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRDb2xvcmVkKG5ldyBmLkNvbG9yKDAuNzUsIDAuOCwgMC43NSwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5CT0RZX1RZUEUuRFlOQU1JQywgZi5DT0xMSVNJT05fR1JPVVAuR1JPVVBfMik7XHJcbiAgICBsZWcubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoLTAuNCwgMyArIHNwYXduSGVpZ2h0LCAwLjQpKTtcclxuICAgIGxlZy5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDAuMiwgMC44LCAwLjIpKTtcclxuICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChsZWcpO1xyXG5cclxuICAgIHdlbGRpbmdKb2ludCA9IG5ldyBmLkpvaW50V2VsZGluZyhiYXNlLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSksIGxlZy5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpKTtcclxuICAgIGJhY2suYWRkQ29tcG9uZW50KHdlbGRpbmdKb2ludCk7XHJcbiAgICBmLlBoeXNpY3MuYWRqdXN0VHJhbnNmb3JtcyhoaWVyYXJjaHkpOyAvLyBJbXBvcnRhbnQhIFlvdSBuZWVkIHRvIGF0IGxlYXN0IGFkanVzdCBUcmFuc2Zvcm1zIGZvciB0aGUgcGFydHMgb2YgdGhlIGNoYWlyXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBtZWFzdXJlRlBTKCk6IHZvaWQge1xyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vdzogbnVtYmVyID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgIHdoaWxlICh0aW1lcy5sZW5ndGggPiAwICYmIHRpbWVzWzBdIDw9IG5vdyAtIDEwMDApIHtcclxuICAgICAgICB0aW1lcy5zaGlmdCgpO1xyXG4gICAgICB9XHJcbiAgICAgIHRpbWVzLnB1c2gobm93KTtcclxuICAgICAgZnBzID0gdGltZXMubGVuZ3RoO1xyXG4gICAgICBmcHNEaXNwbGF5LnRleHRDb250ZW50ID0gYEZQUzogJHtmcHMudG9TdHJpbmcoKX0gLyBDaGFpcnM6ICR7bm9DaGFpcnN9IC8gQm9kaWVzOiAke2YuUGh5c2ljcy53b3JsZC5nZXRCb2R5TGlzdCgpLmxlbmd0aH1gO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbn0iXX0=