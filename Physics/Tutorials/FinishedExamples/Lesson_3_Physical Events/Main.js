"use strict";
///<reference types="../../../../Core/Build/FudgeCore.js"/>
var f = FudgeCore;
//Reference Fudge, getting code completion ready and creating a shortcut f to write FudgeCode more comfortably
var Turorials_FUDGEPhysics_Lesson1;
//Reference Fudge, getting code completion ready and creating a shortcut f to write FudgeCode more comfortably
(function (Turorials_FUDGEPhysics_Lesson1) {
    //Goal: Learn how to create and use physics based events (Collision/Trigger) to control nodes in the app.
    //Fudge Basic Variables
    window.addEventListener("load", init);
    const app = document.querySelector("canvas"); // The html element where the scene is drawn to
    let viewPort; // The scene visualization
    let hierarchy; // You're object scene tree
    //Physical Objects
    let bodies = new Array(); // Array of all physical objects in the scene to have a quick reference
    let playerBody; // Transform of a body that interacts with physics but can be moved by normal FudgeTransform
    //Setting Variables
    let force = 0.5; //The amount of movement with each keypress
    let playerDefaultMat = new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0, 0, 1, 1)));
    let playerTriggeredMat = new f.Material("CubeTriggered", f.ShaderFlat, new f.CoatColored(new f.Color(0.9, 0.1, 0.1, 1)));
    //Function to initialize the Fudge Scene with a camera, light, viewport and PHYSCIAL Objects
    function init(_event) {
        hierarchy = new f.Node("Scene"); //create the root Node where every object is parented to. Should never be changed
        //#region PHYSICS
        //PHYSICS - Step 2: Create some physical Nodes to play with 
        //Creating a physically static ground plane for our physics playground. A simple scaled cube but with physics type set to static
        bodies[0] = createCompleteNode("Ground", new f.Material("Ground", f.ShaderFlat, new f.CoatColored(new f.Color(0.2, 0.2, 0.2, 1))), new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC);
        bodies[0].mtxLocal.scale(new f.Vector3(14, 0.3, 14)); //Scale the body with it's standard ComponentTransform
        bodies[0].mtxLocal.rotateX(4, true); //Give it a slight rotation so the physical objects are sliding, always from left when it's after a scaling
        hierarchy.appendChild(bodies[0]); //Add the node to the scene by adding it to the scene-root
        //Step 1 - Creating a the player cube - to interact to trigger, COLLIDERS and TRIGGERS 
        bodies[1] = createCompleteNode("Player", playerDefaultMat, new f.MeshCube(), 1, f.PHYSICS_TYPE.DYNAMIC);
        playerBody = bodies[1]; //Reference this node specifically so we can access it for input more easily
        playerBody.mtxLocal.translate(new f.Vector3(0, 1, 0));
        hierarchy.appendChild(bodies[1]);
        playerBody.getComponent(f.ComponentRigidbody).rotationInfluenceFactor = new f.Vector3(0, 0, 0); //make rotation fixed the player does not rotate
        playerBody.getComponent(f.ComponentRigidbody).friction = 1;
        //Step 2 - Create bodies - one used as a button when it collides it will an action will happen - one as a trigger, when it's overlapping it will trigger an action
        //The Collision Event is happening on a collision so a normal body can receive it
        //A use case for a collision event is for example when the player is hitting the ground to play a sound
        bodies[2] = createCompleteNode("Collider_Button", new f.Material("Collider_Button", f.ShaderFlat, new f.CoatColored(new f.Color(0.3, 0.3, 0.4, 1))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC);
        bodies[2].mtxLocal.translate(new f.Vector3(-3, 1, 0));
        hierarchy.appendChild(bodies[2]);
        //The Trigger Event is happening when bodies overlap, so we need a special body that does not collide but overlap
        //So it must be in the PHYSICS_GROUP.TRIGGER, and normally it's invisble, so it has no mesh component or is fully transparent
        //A use case is something like spawning enemies when a player enters a room.
        bodies[3] = createCompleteNode("Trigger_Button", new f.Material("Trigger_Button", f.ShaderFlat, new f.CoatColored(new f.Color(0.5, 0.3, 0.2, 0.3))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.TRIGGER);
        bodies[3].mtxLocal.translate(new f.Vector3(3, 1, 0));
        hierarchy.appendChild(bodies[3]);
        //Trigger when player is falling of the plane
        bodies[4] = createCompleteNode("Trigger_Reset", new f.Material("Trigger_Reset", f.ShaderFlat, new f.CoatColored(new f.Color(0.5, 0.3, 0.2, 0.3))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.TRIGGER);
        bodies[4].removeComponent(bodies[4].getComponent(f.ComponentMesh)); //removing the mesh to have invisible trigger - standard practice
        bodies[4].mtxLocal.translate(new f.Vector3(0, -4, 0));
        bodies[4].mtxLocal.scale(new f.Vector3(30, 1, 30)); //Make it big enough so the player should hit it
        hierarchy.appendChild(bodies[4]);
        //Step 3 - After creating our Physic Event Bodies, we tell them to listen to the specific event happening
        //These events are happening on the physic component not on the node. So be sure to add them to the component not to the node
        //A body can receive a enter/exit event, and it's only happening once. If a body is staying on a collision or in a trigger it needs to be handled manually
        bodies[2].getComponent(f.ComponentRigidbody).addEventListener("ColliderEnteredCollision" /* COLLISION_ENTER */, hndCollisionEventEnter);
        bodies[2].getComponent(f.ComponentRigidbody).addEventListener("ColliderLeftCollision" /* COLLISION_EXIT */, hndCollisionEventExit);
        /*Hint: The Collision Event is only happening if the object is hitting it physically,
          So KINEMATIC vs. STATIC does not receive a collision Event. Only DYNAMIC vs. DYNAMIC/STATIC/KINEMATIC, neither do two Kinematic hit each other nor do Kinematic/Static.
          If you really need a kinematic hitting a static object and still have a action, use trigger, or make the object not static but dynamic but unmoving by having a ridiculously high weight.
          Thats why we use a dynamic player cube instead of a kinematic like we did in Lesson 1.
        */
        //Same as for collision a trigger is also listening on a event type in form of f.EVENT_PHYSICS and a function that will be called
        bodies[3].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, hndTriggerEventEnter);
        bodies[3].getComponent(f.ComponentRigidbody).addEventListener("TriggerLeftCollision" /* TRIGGER_EXIT */, hndTriggerEventExit);
        //Setting up our reset
        bodies[4].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, hndResetTrigger);
        //#endregion PHYSICS
        //Standard Fudge Scene Initialization - Creating a directional light, a camera and initialize the viewport
        let cmpLight = new f.ComponentLight(new f.LightDirectional(f.Color.CSS("WHITE")));
        cmpLight.pivot.lookAt(new f.Vector3(0.5, -1, -0.8)); //Set light direction
        hierarchy.addComponent(cmpLight);
        let cmpCamera = new f.ComponentCamera();
        cmpCamera.backgroundColor = f.Color.CSS("GREY");
        cmpCamera.pivot.translate(new f.Vector3(2, 3.5, 17)); //Move camera far back so the whole scene is visible
        cmpCamera.pivot.lookAt(f.Vector3.ZERO()); //Set the camera matrix so that it looks at the center of the scene
        viewPort = new f.Viewport(); //Creating a viewport that is rendered onto the html canvas element
        viewPort.initialize("Viewport", hierarchy, cmpCamera, app); //initialize the viewport with the root node, camera and canvas
        document.addEventListener("keypress", hndKey); //Adding a listener for keypress handling
        //PHYSICS - Start using physics by telling the physics the scene root object. Physics will recalculate every transform and initialize
        f.Physics.start(hierarchy);
        //Important start the game loop after starting physics, so physics can use the current transform before it's first iteration
        f.Loop.addEventListener("loopFrame" /* LOOP_FRAME */, update); //Tell the game loop to call the update function on each frame
        f.Loop.start(); //Stard the game loop
    }
    //Function to animate/update the Fudge scene, commonly known as gameloop
    function update() {
        f.Physics.world.simulate(); //PHYSICS - Simulate physical changes each frame, parameter to set time between frames
        viewPort.draw(); // Draw the current Fudge Scene to the canvas
    }
    // Function to quickly create a node with multiple needed FudgeComponents, including a physics component
    function createCompleteNode(_name, _material, _mesh, _mass, _physicsType, _group = f.PHYSICS_GROUP.DEFAULT, _colType = f.COLLIDER_TYPE.CUBE) {
        let node = new f.Node(_name); //Creating the node
        let cmpMesh = new f.ComponentMesh(_mesh); //Creating a mesh for the node
        let cmpMaterial = new f.ComponentMaterial(_material); //Creating a material for the node
        let cmpTransform = new f.ComponentTransform(); //Transform holding position/rotation/scaling of the node
        let cmpRigidbody = new f.ComponentRigidbody(_mass, _physicsType, _colType, _group); //<-- adding the group when using triggers, since a trigger should not collide with anything else
        node.addComponent(cmpMesh);
        node.addComponent(cmpMaterial);
        node.addComponent(cmpTransform);
        node.addComponent(cmpRigidbody); // <-- best practice to add physics component last
        return node; //return the full created node
    }
    // Event Function handling keyboard input - similar to Lesson 1 but a little different, since it's pushing the player by force
    function hndKey(_event) {
        let horizontal = 0; //left/right
        let vertical = 0; //front/back
        let height = 0; //upwards/downwards
        //Check keyboard input from Event
        if (_event.code == f.KEYBOARD_CODE.A) {
            horizontal -= force;
        }
        if (_event.code == f.KEYBOARD_CODE.D) {
            horizontal += force;
        }
        if (_event.code == f.KEYBOARD_CODE.W) {
            vertical -= force;
        }
        if (_event.code == f.KEYBOARD_CODE.S) {
            vertical += force;
        }
        if (_event.code == f.KEYBOARD_CODE.SPACE) { //Jump
            height += force * 10;
        }
        playerBody.getComponent(f.ComponentRigidbody).applyLinearImpulse(new f.Vector3(horizontal, height, vertical));
    }
    //Step 4 - Receiving and handling the events
    //Event function handling collision - A EVENT_PHYSICS is receiving a f.EventPhysics with infos about the event
    function hndCollisionEventEnter(_event) {
        //_event. keeps a plethora of informations about the event the most interesting are things like 
        /*
          _event.cmpRigidbody -> to identify the body involved in the event, with getContainer().name you get the actual name of the node involved
          _event.normalImpulse -> intensity of the collision good to play a sound that is only as heavy as the collision
          _event.collisionPoint -> the point in the world where the collision is happening to maybe spawn things like particles
          _event.collisionNormal -> the direction the collision is happening often used to correctly rotate spawned things on the colliding surface
        */
        if (_event.cmpRigidbody.getContainer().name == "Player") { //Our Event is happening with the body NODE called "Player"
            f.Debug.log("Player hit me - Collider");
            //We let this collider act like a bumper through this event. We take the event normal and shoot the player away from the bumper on the contact point.
            playerBody.getComponent(f.ComponentRigidbody).applyForceAtPoint(new f.Vector3(_event.collisionNormal.x * 500, _event.collisionNormal.y * 500, _event.collisionNormal.z * 500), _event.collisionPoint);
        }
    }
    function hndCollisionEventExit(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            f.Debug.log("Player left me - Collider");
        }
    }
    //Event function handling triggering
    function hndTriggerEventEnter(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            f.Debug.log("Player entered me - Trigger");
            playerBody.getComponent(f.ComponentMaterial).material = playerTriggeredMat;
        }
    }
    function hndTriggerEventExit(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            f.Debug.log("Player left me - Trigger");
            playerBody.getComponent(f.ComponentMaterial).material = playerDefaultMat;
        }
    }
    //Since the player could fall of we will reset him back with a trigger when he falls down from the plane
    function hndResetTrigger(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Player") {
            playerBody.getComponent(f.ComponentRigidbody).setPosition(new f.Vector3(0, 3, 0)); //Since it's a physics body we have to set position through physics not transform
        }
    }
})(Turorials_FUDGEPhysics_Lesson1 || (Turorials_FUDGEPhysics_Lesson1 = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDJEQUEyRDtBQUMzRCxJQUFPLENBQUMsR0FBRyxTQUFTLENBQUM7QUFDckIsOEdBQThHO0FBRTlHLElBQVUsOEJBQThCLENBd012QztBQTFNRCw4R0FBOEc7QUFFOUcsV0FBVSw4QkFBOEI7SUFFdEMseUdBQXlHO0lBRXpHLHVCQUF1QjtJQUN2QixNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sR0FBRyxHQUFzQixRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsK0NBQStDO0lBQ2hILElBQUksUUFBb0IsQ0FBQyxDQUFDLDBCQUEwQjtJQUNwRCxJQUFJLFNBQWlCLENBQUMsQ0FBQywyQkFBMkI7SUFHbEQsa0JBQWtCO0lBQ2xCLElBQUksTUFBTSxHQUFhLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyx1RUFBdUU7SUFDM0csSUFBSSxVQUFrQixDQUFDLENBQUMsNEZBQTRGO0lBR3BILG1CQUFtQjtJQUNuQixJQUFJLEtBQUssR0FBVyxHQUFHLENBQUMsQ0FBQywyQ0FBMkM7SUFDcEUsSUFBSSxnQkFBZ0IsR0FBZSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEgsSUFBSSxrQkFBa0IsR0FBZSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FB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QUksSUFBSSxRQUFRLEVBQUU7WUFDdkQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztZQUMzQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFFBQVEsR0FBRyxrQkFBa0IsQ0FBQztTQUM1RTtJQUNILENBQUM7SUFFRCxTQUFTLG1CQUFtQixDQUFDLE1BQXNCO1FBQ2pELElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQ3ZELENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDeEMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxRQUFRLEdBQUcsZ0JBQWdCLENBQUM7U0FDMUU7SUFDSCxDQUFDO0lBRUQsd0dBQXdHO0lBQ3hHLFNBQVMsZUFBZSxDQUFDLE1BQXNCO1FBQzdDLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQ3ZELFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxpRkFBaUY7U0FDcks7SUFDSCxDQUFDO0FBRUgsQ0FBQyxFQXhNUyw4QkFBOEIsS0FBOUIsOEJBQThCLFFBd012QyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgdHlwZXM9XCIuLi8uLi8uLi8uLi9Db3JlL0J1aWxkL0Z1ZGdlQ29yZS5qc1wiLz5cclxuaW1wb3J0IGYgPSBGdWRnZUNvcmU7XHJcbi8vUmVmZXJlbmNlIEZ1ZGdlLCBnZXR0aW5nIGNvZGUgY29tcGxldGlvbiByZWFkeSBhbmQgY3JlYXRpbmcgYSBzaG9ydGN1dCBmIHRvIHdyaXRlIEZ1ZGdlQ29kZSBtb3JlIGNvbWZvcnRhYmx5XHJcblxyXG5uYW1lc3BhY2UgVHVyb3JpYWxzX0ZVREdFUGh5c2ljc19MZXNzb24xIHtcclxuXHJcbiAgLy9Hb2FsOiBMZWFybiBob3cgdG8gY3JlYXRlIGFuZCB1c2UgcGh5c2ljcyBiYXNlZCBldmVudHMgKENvbGxpc2lvbi9UcmlnZ2VyKSB0byBjb250cm9sIG5vZGVzIGluIHRoZSBhcHAuXHJcblxyXG4gIC8vRnVkZ2UgQmFzaWMgVmFyaWFibGVzXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGluaXQpO1xyXG4gIGNvbnN0IGFwcDogSFRNTENhbnZhc0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiY2FudmFzXCIpOyAvLyBUaGUgaHRtbCBlbGVtZW50IHdoZXJlIHRoZSBzY2VuZSBpcyBkcmF3biB0b1xyXG4gIGxldCB2aWV3UG9ydDogZi5WaWV3cG9ydDsgLy8gVGhlIHNjZW5lIHZpc3VhbGl6YXRpb25cclxuICBsZXQgaGllcmFyY2h5OiBmLk5vZGU7IC8vIFlvdSdyZSBvYmplY3Qgc2NlbmUgdHJlZVxyXG5cclxuXHJcbiAgLy9QaHlzaWNhbCBPYmplY3RzXHJcbiAgbGV0IGJvZGllczogZi5Ob2RlW10gPSBuZXcgQXJyYXkoKTsgLy8gQXJyYXkgb2YgYWxsIHBoeXNpY2FsIG9iamVjdHMgaW4gdGhlIHNjZW5lIHRvIGhhdmUgYSBxdWljayByZWZlcmVuY2VcclxuICBsZXQgcGxheWVyQm9keTogZi5Ob2RlOyAvLyBUcmFuc2Zvcm0gb2YgYSBib2R5IHRoYXQgaW50ZXJhY3RzIHdpdGggcGh5c2ljcyBidXQgY2FuIGJlIG1vdmVkIGJ5IG5vcm1hbCBGdWRnZVRyYW5zZm9ybVxyXG5cclxuXHJcbiAgLy9TZXR0aW5nIFZhcmlhYmxlc1xyXG4gIGxldCBmb3JjZTogbnVtYmVyID0gMC41OyAvL1RoZSBhbW91bnQgb2YgbW92ZW1lbnQgd2l0aCBlYWNoIGtleXByZXNzXHJcbiAgbGV0IHBsYXllckRlZmF1bHRNYXQ6IGYuTWF0ZXJpYWwgPSBuZXcgZi5NYXRlcmlhbChcIkN1YmVcIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLCAwLCAxLCAxKSkpO1xyXG4gIGxldCBwbGF5ZXJUcmlnZ2VyZWRNYXQ6IGYuTWF0ZXJpYWwgPSBuZXcgZi5NYXRlcmlhbChcIkN1YmVUcmlnZ2VyZWRcIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjksIDAuMSwgMC4xLCAxKSkpO1xyXG5cclxuICAvL0Z1bmN0aW9uIHRvIGluaXRpYWxpemUgdGhlIEZ1ZGdlIFNjZW5lIHdpdGggYSBjYW1lcmEsIGxpZ2h0LCB2aWV3cG9ydCBhbmQgUEhZU0NJQUwgT2JqZWN0c1xyXG4gIGZ1bmN0aW9uIGluaXQoX2V2ZW50OiBFdmVudCk6IHZvaWQge1xyXG5cclxuICAgIGhpZXJhcmNoeSA9IG5ldyBmLk5vZGUoXCJTY2VuZVwiKTsgLy9jcmVhdGUgdGhlIHJvb3QgTm9kZSB3aGVyZSBldmVyeSBvYmplY3QgaXMgcGFyZW50ZWQgdG8uIFNob3VsZCBuZXZlciBiZSBjaGFuZ2VkXHJcblxyXG4gICAgLy8jcmVnaW9uIFBIWVNJQ1NcclxuXHJcbiAgICAvL1BIWVNJQ1MgLSBTdGVwIDI6IENyZWF0ZSBzb21lIHBoeXNpY2FsIE5vZGVzIHRvIHBsYXkgd2l0aCBcclxuICAgIC8vQ3JlYXRpbmcgYSBwaHlzaWNhbGx5IHN0YXRpYyBncm91bmQgcGxhbmUgZm9yIG91ciBwaHlzaWNzIHBsYXlncm91bmQuIEEgc2ltcGxlIHNjYWxlZCBjdWJlIGJ1dCB3aXRoIHBoeXNpY3MgdHlwZSBzZXQgdG8gc3RhdGljXHJcbiAgICBib2RpZXNbMF0gPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJHcm91bmRcIiwgbmV3IGYuTWF0ZXJpYWwoXCJHcm91bmRcIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjIsIDAuMiwgMC4yLCAxKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMpO1xyXG4gICAgYm9kaWVzWzBdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMTQsIDAuMywgMTQpKTsgLy9TY2FsZSB0aGUgYm9keSB3aXRoIGl0J3Mgc3RhbmRhcmQgQ29tcG9uZW50VHJhbnNmb3JtXHJcbiAgICBib2RpZXNbMF0ubXR4TG9jYWwucm90YXRlWCg0LCB0cnVlKTsgLy9HaXZlIGl0IGEgc2xpZ2h0IHJvdGF0aW9uIHNvIHRoZSBwaHlzaWNhbCBvYmplY3RzIGFyZSBzbGlkaW5nLCBhbHdheXMgZnJvbSBsZWZ0IHdoZW4gaXQncyBhZnRlciBhIHNjYWxpbmdcclxuICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChib2RpZXNbMF0pOyAvL0FkZCB0aGUgbm9kZSB0byB0aGUgc2NlbmUgYnkgYWRkaW5nIGl0IHRvIHRoZSBzY2VuZS1yb290XHJcblxyXG4gICAgLy9TdGVwIDEgLSBDcmVhdGluZyBhIHRoZSBwbGF5ZXIgY3ViZSAtIHRvIGludGVyYWN0IHRvIHRyaWdnZXIsIENPTExJREVSUyBhbmQgVFJJR0dFUlMgXHJcbiAgICBib2RpZXNbMV0gPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJQbGF5ZXJcIiwgcGxheWVyRGVmYXVsdE1hdCwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5QSFlTSUNTX1RZUEUuRFlOQU1JQyk7XHJcbiAgICBwbGF5ZXJCb2R5ID0gYm9kaWVzWzFdOyAvL1JlZmVyZW5jZSB0aGlzIG5vZGUgc3BlY2lmaWNhbGx5IHNvIHdlIGNhbiBhY2Nlc3MgaXQgZm9yIGlucHV0IG1vcmUgZWFzaWx5XHJcbiAgICBwbGF5ZXJCb2R5Lm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDAsIDEsIDApKTtcclxuICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChib2RpZXNbMV0pO1xyXG4gICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLnJvdGF0aW9uSW5mbHVlbmNlRmFjdG9yID0gbmV3IGYuVmVjdG9yMygwLCAwLCAwKTsgLy9tYWtlIHJvdGF0aW9uIGZpeGVkIHRoZSBwbGF5ZXIgZG9lcyBub3Qgcm90YXRlXHJcbiAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuZnJpY3Rpb24gPSAxO1xyXG5cclxuICAgIC8vU3RlcCAyIC0gQ3JlYXRlIGJvZGllcyAtIG9uZSB1c2VkIGFzIGEgYnV0dG9uIHdoZW4gaXQgY29sbGlkZXMgaXQgd2lsbCBhbiBhY3Rpb24gd2lsbCBoYXBwZW4gLSBvbmUgYXMgYSB0cmlnZ2VyLCB3aGVuIGl0J3Mgb3ZlcmxhcHBpbmcgaXQgd2lsbCB0cmlnZ2VyIGFuIGFjdGlvblxyXG4gICAgLy9UaGUgQ29sbGlzaW9uIEV2ZW50IGlzIGhhcHBlbmluZyBvbiBhIGNvbGxpc2lvbiBzbyBhIG5vcm1hbCBib2R5IGNhbiByZWNlaXZlIGl0XHJcbiAgICAvL0EgdXNlIGNhc2UgZm9yIGEgY29sbGlzaW9uIGV2ZW50IGlzIGZvciBleGFtcGxlIHdoZW4gdGhlIHBsYXllciBpcyBoaXR0aW5nIHRoZSBncm91bmQgdG8gcGxheSBhIHNvdW5kXHJcbiAgICBib2RpZXNbMl0gPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJDb2xsaWRlcl9CdXR0b25cIiwgbmV3IGYuTWF0ZXJpYWwoXCJDb2xsaWRlcl9CdXR0b25cIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjMsIDAuMywgMC40LCAxKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMpO1xyXG4gICAgYm9kaWVzWzJdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKC0zLCAxLCAwKSk7XHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzJdKTtcclxuXHJcbiAgICAvL1RoZSBUcmlnZ2VyIEV2ZW50IGlzIGhhcHBlbmluZyB3aGVuIGJvZGllcyBvdmVybGFwLCBzbyB3ZSBuZWVkIGEgc3BlY2lhbCBib2R5IHRoYXQgZG9lcyBub3QgY29sbGlkZSBidXQgb3ZlcmxhcFxyXG4gICAgLy9TbyBpdCBtdXN0IGJlIGluIHRoZSBQSFlTSUNTX0dST1VQLlRSSUdHRVIsIGFuZCBub3JtYWxseSBpdCdzIGludmlzYmxlLCBzbyBpdCBoYXMgbm8gbWVzaCBjb21wb25lbnQgb3IgaXMgZnVsbHkgdHJhbnNwYXJlbnRcclxuICAgIC8vQSB1c2UgY2FzZSBpcyBzb21ldGhpbmcgbGlrZSBzcGF3bmluZyBlbmVtaWVzIHdoZW4gYSBwbGF5ZXIgZW50ZXJzIGEgcm9vbS5cclxuICAgIGJvZGllc1szXSA9IGNyZWF0ZUNvbXBsZXRlTm9kZShcIlRyaWdnZXJfQnV0dG9uXCIsIG5ldyBmLk1hdGVyaWFsKFwiVHJpZ2dlcl9CdXR0b25cIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjUsIDAuMywgMC4yLCAwLjMpKSksIG5ldyBmLk1lc2hDdWJlKCksIDEsIGYuUEhZU0lDU19UWVBFLlNUQVRJQywgZi5QSFlTSUNTX0dST1VQLlRSSUdHRVIpO1xyXG4gICAgYm9kaWVzWzNdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDMsIDEsIDApKTtcclxuICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChib2RpZXNbM10pO1xyXG5cclxuICAgIC8vVHJpZ2dlciB3aGVuIHBsYXllciBpcyBmYWxsaW5nIG9mIHRoZSBwbGFuZVxyXG4gICAgYm9kaWVzWzRdID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiVHJpZ2dlcl9SZXNldFwiLCBuZXcgZi5NYXRlcmlhbChcIlRyaWdnZXJfUmVzZXRcIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjUsIDAuMywgMC4yLCAwLjMpKSksIG5ldyBmLk1lc2hDdWJlKCksIDEsIGYuUEhZU0lDU19UWVBFLlNUQVRJQywgZi5QSFlTSUNTX0dST1VQLlRSSUdHRVIpO1xyXG4gICAgYm9kaWVzWzRdLnJlbW92ZUNvbXBvbmVudChib2RpZXNbNF0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50TWVzaCkpOyAvL3JlbW92aW5nIHRoZSBtZXNoIHRvIGhhdmUgaW52aXNpYmxlIHRyaWdnZXIgLSBzdGFuZGFyZCBwcmFjdGljZVxyXG4gICAgYm9kaWVzWzRdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDAsIC00LCAwKSk7XHJcbiAgICBib2RpZXNbNF0ubXR4TG9jYWwuc2NhbGUobmV3IGYuVmVjdG9yMygzMCwgMSwgMzApKTsgLy9NYWtlIGl0IGJpZyBlbm91Z2ggc28gdGhlIHBsYXllciBzaG91bGQgaGl0IGl0XHJcbiAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzRdKTtcclxuXHJcbiAgICAvL1N0ZXAgMyAtIEFmdGVyIGNyZWF0aW5nIG91ciBQaHlzaWMgRXZlbnQgQm9kaWVzLCB3ZSB0ZWxsIHRoZW0gdG8gbGlzdGVuIHRvIHRoZSBzcGVjaWZpYyBldmVudCBoYXBwZW5pbmdcclxuICAgIC8vVGhlc2UgZXZlbnRzIGFyZSBoYXBwZW5pbmcgb24gdGhlIHBoeXNpYyBjb21wb25lbnQgbm90IG9uIHRoZSBub2RlLiBTbyBiZSBzdXJlIHRvIGFkZCB0aGVtIHRvIHRoZSBjb21wb25lbnQgbm90IHRvIHRoZSBub2RlXHJcbiAgICAvL0EgYm9keSBjYW4gcmVjZWl2ZSBhIGVudGVyL2V4aXQgZXZlbnQsIGFuZCBpdCdzIG9ubHkgaGFwcGVuaW5nIG9uY2UuIElmIGEgYm9keSBpcyBzdGF5aW5nIG9uIGEgY29sbGlzaW9uIG9yIGluIGEgdHJpZ2dlciBpdCBuZWVkcyB0byBiZSBoYW5kbGVkIG1hbnVhbGx5XHJcbiAgICBib2RpZXNbMl0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlRfUEhZU0lDUy5DT0xMSVNJT05fRU5URVIsIGhuZENvbGxpc2lvbkV2ZW50RW50ZXIpO1xyXG4gICAgYm9kaWVzWzJdLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5UX1BIWVNJQ1MuQ09MTElTSU9OX0VYSVQsIGhuZENvbGxpc2lvbkV2ZW50RXhpdCk7XHJcbiAgICAvKkhpbnQ6IFRoZSBDb2xsaXNpb24gRXZlbnQgaXMgb25seSBoYXBwZW5pbmcgaWYgdGhlIG9iamVjdCBpcyBoaXR0aW5nIGl0IHBoeXNpY2FsbHksIFxyXG4gICAgICBTbyBLSU5FTUFUSUMgdnMuIFNUQVRJQyBkb2VzIG5vdCByZWNlaXZlIGEgY29sbGlzaW9uIEV2ZW50LiBPbmx5IERZTkFNSUMgdnMuIERZTkFNSUMvU1RBVElDL0tJTkVNQVRJQywgbmVpdGhlciBkbyB0d28gS2luZW1hdGljIGhpdCBlYWNoIG90aGVyIG5vciBkbyBLaW5lbWF0aWMvU3RhdGljLlxyXG4gICAgICBJZiB5b3UgcmVhbGx5IG5lZWQgYSBraW5lbWF0aWMgaGl0dGluZyBhIHN0YXRpYyBvYmplY3QgYW5kIHN0aWxsIGhhdmUgYSBhY3Rpb24sIHVzZSB0cmlnZ2VyLCBvciBtYWtlIHRoZSBvYmplY3Qgbm90IHN0YXRpYyBidXQgZHluYW1pYyBidXQgdW5tb3ZpbmcgYnkgaGF2aW5nIGEgcmlkaWN1bG91c2x5IGhpZ2ggd2VpZ2h0LlxyXG4gICAgICBUaGF0cyB3aHkgd2UgdXNlIGEgZHluYW1pYyBwbGF5ZXIgY3ViZSBpbnN0ZWFkIG9mIGEga2luZW1hdGljIGxpa2Ugd2UgZGlkIGluIExlc3NvbiAxLlxyXG4gICAgKi9cclxuXHJcbiAgICAvL1NhbWUgYXMgZm9yIGNvbGxpc2lvbiBhIHRyaWdnZXIgaXMgYWxzbyBsaXN0ZW5pbmcgb24gYSBldmVudCB0eXBlIGluIGZvcm0gb2YgZi5FVkVOVF9QSFlTSUNTIGFuZCBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWRcclxuICAgIGJvZGllc1szXS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVF9QSFlTSUNTLlRSSUdHRVJfRU5URVIsIGhuZFRyaWdnZXJFdmVudEVudGVyKTtcclxuICAgIGJvZGllc1szXS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVF9QSFlTSUNTLlRSSUdHRVJfRVhJVCwgaG5kVHJpZ2dlckV2ZW50RXhpdCk7XHJcblxyXG4gICAgLy9TZXR0aW5nIHVwIG91ciByZXNldFxyXG4gICAgYm9kaWVzWzRdLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5UX1BIWVNJQ1MuVFJJR0dFUl9FTlRFUiwgaG5kUmVzZXRUcmlnZ2VyKTtcclxuICAgIC8vI2VuZHJlZ2lvbiBQSFlTSUNTXHJcblxyXG5cclxuICAgIC8vU3RhbmRhcmQgRnVkZ2UgU2NlbmUgSW5pdGlhbGl6YXRpb24gLSBDcmVhdGluZyBhIGRpcmVjdGlvbmFsIGxpZ2h0LCBhIGNhbWVyYSBhbmQgaW5pdGlhbGl6ZSB0aGUgdmlld3BvcnRcclxuICAgIGxldCBjbXBMaWdodDogZi5Db21wb25lbnRMaWdodCA9IG5ldyBmLkNvbXBvbmVudExpZ2h0KG5ldyBmLkxpZ2h0RGlyZWN0aW9uYWwoZi5Db2xvci5DU1MoXCJXSElURVwiKSkpO1xyXG4gICAgY21wTGlnaHQucGl2b3QubG9va0F0KG5ldyBmLlZlY3RvcjMoMC41LCAtMSwgLTAuOCkpOyAvL1NldCBsaWdodCBkaXJlY3Rpb25cclxuICAgIGhpZXJhcmNoeS5hZGRDb21wb25lbnQoY21wTGlnaHQpO1xyXG5cclxuICAgIGxldCBjbXBDYW1lcmE6IGYuQ29tcG9uZW50Q2FtZXJhID0gbmV3IGYuQ29tcG9uZW50Q2FtZXJhKCk7XHJcbiAgICBjbXBDYW1lcmEuYmFja2dyb3VuZENvbG9yID0gZi5Db2xvci5DU1MoXCJHUkVZXCIpO1xyXG4gICAgY21wQ2FtZXJhLnBpdm90LnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDIsIDMuNSwgMTcpKTsgLy9Nb3ZlIGNhbWVyYSBmYXIgYmFjayBzbyB0aGUgd2hvbGUgc2NlbmUgaXMgdmlzaWJsZVxyXG4gICAgY21wQ2FtZXJhLnBpdm90Lmxvb2tBdChmLlZlY3RvcjMuWkVSTygpKTsgLy9TZXQgdGhlIGNhbWVyYSBtYXRyaXggc28gdGhhdCBpdCBsb29rcyBhdCB0aGUgY2VudGVyIG9mIHRoZSBzY2VuZVxyXG5cclxuICAgIHZpZXdQb3J0ID0gbmV3IGYuVmlld3BvcnQoKTsgLy9DcmVhdGluZyBhIHZpZXdwb3J0IHRoYXQgaXMgcmVuZGVyZWQgb250byB0aGUgaHRtbCBjYW52YXMgZWxlbWVudFxyXG4gICAgdmlld1BvcnQuaW5pdGlhbGl6ZShcIlZpZXdwb3J0XCIsIGhpZXJhcmNoeSwgY21wQ2FtZXJhLCBhcHApOyAvL2luaXRpYWxpemUgdGhlIHZpZXdwb3J0IHdpdGggdGhlIHJvb3Qgbm9kZSwgY2FtZXJhIGFuZCBjYW52YXNcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5cHJlc3NcIiwgaG5kS2V5KTsgLy9BZGRpbmcgYSBsaXN0ZW5lciBmb3Iga2V5cHJlc3MgaGFuZGxpbmdcclxuXHJcbiAgICAvL1BIWVNJQ1MgLSBTdGFydCB1c2luZyBwaHlzaWNzIGJ5IHRlbGxpbmcgdGhlIHBoeXNpY3MgdGhlIHNjZW5lIHJvb3Qgb2JqZWN0LiBQaHlzaWNzIHdpbGwgcmVjYWxjdWxhdGUgZXZlcnkgdHJhbnNmb3JtIGFuZCBpbml0aWFsaXplXHJcbiAgICBmLlBoeXNpY3Muc3RhcnQoaGllcmFyY2h5KTtcclxuXHJcbiAgICAvL0ltcG9ydGFudCBzdGFydCB0aGUgZ2FtZSBsb29wIGFmdGVyIHN0YXJ0aW5nIHBoeXNpY3MsIHNvIHBoeXNpY3MgY2FuIHVzZSB0aGUgY3VycmVudCB0cmFuc2Zvcm0gYmVmb3JlIGl0J3MgZmlyc3QgaXRlcmF0aW9uXHJcbiAgICBmLkxvb3AuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5ULkxPT1BfRlJBTUUsIHVwZGF0ZSk7IC8vVGVsbCB0aGUgZ2FtZSBsb29wIHRvIGNhbGwgdGhlIHVwZGF0ZSBmdW5jdGlvbiBvbiBlYWNoIGZyYW1lXHJcbiAgICBmLkxvb3Auc3RhcnQoKTsgLy9TdGFyZCB0aGUgZ2FtZSBsb29wXHJcbiAgfVxyXG5cclxuICAvL0Z1bmN0aW9uIHRvIGFuaW1hdGUvdXBkYXRlIHRoZSBGdWRnZSBzY2VuZSwgY29tbW9ubHkga25vd24gYXMgZ2FtZWxvb3BcclxuICBmdW5jdGlvbiB1cGRhdGUoKTogdm9pZCB7XHJcbiAgICBmLlBoeXNpY3Mud29ybGQuc2ltdWxhdGUoKTsgLy9QSFlTSUNTIC0gU2ltdWxhdGUgcGh5c2ljYWwgY2hhbmdlcyBlYWNoIGZyYW1lLCBwYXJhbWV0ZXIgdG8gc2V0IHRpbWUgYmV0d2VlbiBmcmFtZXNcclxuICAgIHZpZXdQb3J0LmRyYXcoKTsgLy8gRHJhdyB0aGUgY3VycmVudCBGdWRnZSBTY2VuZSB0byB0aGUgY2FudmFzXHJcbiAgfVxyXG5cclxuICAvLyBGdW5jdGlvbiB0byBxdWlja2x5IGNyZWF0ZSBhIG5vZGUgd2l0aCBtdWx0aXBsZSBuZWVkZWQgRnVkZ2VDb21wb25lbnRzLCBpbmNsdWRpbmcgYSBwaHlzaWNzIGNvbXBvbmVudFxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUNvbXBsZXRlTm9kZShfbmFtZTogc3RyaW5nLCBfbWF0ZXJpYWw6IGYuTWF0ZXJpYWwsIF9tZXNoOiBmLk1lc2gsIF9tYXNzOiBudW1iZXIsIF9waHlzaWNzVHlwZTogZi5QSFlTSUNTX1RZUEUsIF9ncm91cDogZi5QSFlTSUNTX0dST1VQID0gZi5QSFlTSUNTX0dST1VQLkRFRkFVTFQsIF9jb2xUeXBlOiBmLkNPTExJREVSX1RZUEUgPSBmLkNPTExJREVSX1RZUEUuQ1VCRSk6IGYuTm9kZSB7XHJcbiAgICBsZXQgbm9kZTogZi5Ob2RlID0gbmV3IGYuTm9kZShfbmFtZSk7IC8vQ3JlYXRpbmcgdGhlIG5vZGVcclxuICAgIGxldCBjbXBNZXNoOiBmLkNvbXBvbmVudE1lc2ggPSBuZXcgZi5Db21wb25lbnRNZXNoKF9tZXNoKTsgLy9DcmVhdGluZyBhIG1lc2ggZm9yIHRoZSBub2RlXHJcbiAgICBsZXQgY21wTWF0ZXJpYWw6IGYuQ29tcG9uZW50TWF0ZXJpYWwgPSBuZXcgZi5Db21wb25lbnRNYXRlcmlhbChfbWF0ZXJpYWwpOyAvL0NyZWF0aW5nIGEgbWF0ZXJpYWwgZm9yIHRoZSBub2RlXHJcbiAgICBsZXQgY21wVHJhbnNmb3JtOiBmLkNvbXBvbmVudFRyYW5zZm9ybSA9IG5ldyBmLkNvbXBvbmVudFRyYW5zZm9ybSgpOyAgLy9UcmFuc2Zvcm0gaG9sZGluZyBwb3NpdGlvbi9yb3RhdGlvbi9zY2FsaW5nIG9mIHRoZSBub2RlXHJcblxyXG4gICAgbGV0IGNtcFJpZ2lkYm9keTogZi5Db21wb25lbnRSaWdpZGJvZHkgPSBuZXcgZi5Db21wb25lbnRSaWdpZGJvZHkoX21hc3MsIF9waHlzaWNzVHlwZSwgX2NvbFR5cGUsIF9ncm91cCk7IC8vPC0tIGFkZGluZyB0aGUgZ3JvdXAgd2hlbiB1c2luZyB0cmlnZ2Vycywgc2luY2UgYSB0cmlnZ2VyIHNob3VsZCBub3QgY29sbGlkZSB3aXRoIGFueXRoaW5nIGVsc2VcclxuXHJcbiAgICBub2RlLmFkZENvbXBvbmVudChjbXBNZXNoKTtcclxuICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcE1hdGVyaWFsKTtcclxuICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcFRyYW5zZm9ybSk7XHJcbiAgICBub2RlLmFkZENvbXBvbmVudChjbXBSaWdpZGJvZHkpOyAvLyA8LS0gYmVzdCBwcmFjdGljZSB0byBhZGQgcGh5c2ljcyBjb21wb25lbnQgbGFzdFxyXG4gICAgcmV0dXJuIG5vZGU7IC8vcmV0dXJuIHRoZSBmdWxsIGNyZWF0ZWQgbm9kZVxyXG4gIH1cclxuXHJcbiAgLy8gRXZlbnQgRnVuY3Rpb24gaGFuZGxpbmcga2V5Ym9hcmQgaW5wdXQgLSBzaW1pbGFyIHRvIExlc3NvbiAxIGJ1dCBhIGxpdHRsZSBkaWZmZXJlbnQsIHNpbmNlIGl0J3MgcHVzaGluZyB0aGUgcGxheWVyIGJ5IGZvcmNlXHJcbiAgZnVuY3Rpb24gaG5kS2V5KF9ldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xyXG4gICAgbGV0IGhvcml6b250YWw6IG51bWJlciA9IDA7ICAvL2xlZnQvcmlnaHRcclxuICAgIGxldCB2ZXJ0aWNhbDogbnVtYmVyID0gMDsgLy9mcm9udC9iYWNrXHJcbiAgICBsZXQgaGVpZ2h0OiBudW1iZXIgPSAwOyAvL3Vwd2FyZHMvZG93bndhcmRzXHJcblxyXG4gICAgLy9DaGVjayBrZXlib2FyZCBpbnB1dCBmcm9tIEV2ZW50XHJcbiAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLkEpIHtcclxuICAgICAgaG9yaXpvbnRhbCAtPSBmb3JjZTtcclxuICAgIH1cclxuICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuRCkge1xyXG4gICAgICBob3Jpem9udGFsICs9IGZvcmNlO1xyXG4gICAgfVxyXG4gICAgaWYgKF9ldmVudC5jb2RlID09IGYuS0VZQk9BUkRfQ09ERS5XKSB7XHJcbiAgICAgIHZlcnRpY2FsIC09IGZvcmNlO1xyXG4gICAgfVxyXG4gICAgaWYgKF9ldmVudC5jb2RlID09IGYuS0VZQk9BUkRfQ09ERS5TKSB7XHJcbiAgICAgIHZlcnRpY2FsICs9IGZvcmNlO1xyXG4gICAgfVxyXG4gICAgaWYgKF9ldmVudC5jb2RlID09IGYuS0VZQk9BUkRfQ09ERS5TUEFDRSkgeyAvL0p1bXBcclxuICAgICAgaGVpZ2h0ICs9IGZvcmNlICogMTA7XHJcbiAgICB9XHJcbiAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYXBwbHlMaW5lYXJJbXB1bHNlKG5ldyBmLlZlY3RvcjMoaG9yaXpvbnRhbCwgaGVpZ2h0LCB2ZXJ0aWNhbCkpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8vU3RlcCA0IC0gUmVjZWl2aW5nIGFuZCBoYW5kbGluZyB0aGUgZXZlbnRzXHJcbiAgLy9FdmVudCBmdW5jdGlvbiBoYW5kbGluZyBjb2xsaXNpb24gLSBBIEVWRU5UX1BIWVNJQ1MgaXMgcmVjZWl2aW5nIGEgZi5FdmVudFBoeXNpY3Mgd2l0aCBpbmZvcyBhYm91dCB0aGUgZXZlbnRcclxuICBmdW5jdGlvbiBobmRDb2xsaXNpb25FdmVudEVudGVyKF9ldmVudDogZi5FdmVudFBoeXNpY3MpOiB2b2lkIHtcclxuICAgIC8vX2V2ZW50LiBrZWVwcyBhIHBsZXRob3JhIG9mIGluZm9ybWF0aW9ucyBhYm91dCB0aGUgZXZlbnQgdGhlIG1vc3QgaW50ZXJlc3RpbmcgYXJlIHRoaW5ncyBsaWtlIFxyXG4gICAgLyogXHJcbiAgICAgIF9ldmVudC5jbXBSaWdpZGJvZHkgLT4gdG8gaWRlbnRpZnkgdGhlIGJvZHkgaW52b2x2ZWQgaW4gdGhlIGV2ZW50LCB3aXRoIGdldENvbnRhaW5lcigpLm5hbWUgeW91IGdldCB0aGUgYWN0dWFsIG5hbWUgb2YgdGhlIG5vZGUgaW52b2x2ZWQgXHJcbiAgICAgIF9ldmVudC5ub3JtYWxJbXB1bHNlIC0+IGludGVuc2l0eSBvZiB0aGUgY29sbGlzaW9uIGdvb2QgdG8gcGxheSBhIHNvdW5kIHRoYXQgaXMgb25seSBhcyBoZWF2eSBhcyB0aGUgY29sbGlzaW9uXHJcbiAgICAgIF9ldmVudC5jb2xsaXNpb25Qb2ludCAtPiB0aGUgcG9pbnQgaW4gdGhlIHdvcmxkIHdoZXJlIHRoZSBjb2xsaXNpb24gaXMgaGFwcGVuaW5nIHRvIG1heWJlIHNwYXduIHRoaW5ncyBsaWtlIHBhcnRpY2xlc1xyXG4gICAgICBfZXZlbnQuY29sbGlzaW9uTm9ybWFsIC0+IHRoZSBkaXJlY3Rpb24gdGhlIGNvbGxpc2lvbiBpcyBoYXBwZW5pbmcgb2Z0ZW4gdXNlZCB0byBjb3JyZWN0bHkgcm90YXRlIHNwYXduZWQgdGhpbmdzIG9uIHRoZSBjb2xsaWRpbmcgc3VyZmFjZVxyXG4gICAgKi9cclxuICAgIGlmIChfZXZlbnQuY21wUmlnaWRib2R5LmdldENvbnRhaW5lcigpLm5hbWUgPT0gXCJQbGF5ZXJcIikgeyAvL091ciBFdmVudCBpcyBoYXBwZW5pbmcgd2l0aCB0aGUgYm9keSBOT0RFIGNhbGxlZCBcIlBsYXllclwiXHJcbiAgICAgIGYuRGVidWcubG9nKFwiUGxheWVyIGhpdCBtZSAtIENvbGxpZGVyXCIpO1xyXG4gICAgICAvL1dlIGxldCB0aGlzIGNvbGxpZGVyIGFjdCBsaWtlIGEgYnVtcGVyIHRocm91Z2ggdGhpcyBldmVudC4gV2UgdGFrZSB0aGUgZXZlbnQgbm9ybWFsIGFuZCBzaG9vdCB0aGUgcGxheWVyIGF3YXkgZnJvbSB0aGUgYnVtcGVyIG9uIHRoZSBjb250YWN0IHBvaW50LlxyXG4gICAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYXBwbHlGb3JjZUF0UG9pbnQobmV3IGYuVmVjdG9yMyhfZXZlbnQuY29sbGlzaW9uTm9ybWFsLnggKiA1MDAsIF9ldmVudC5jb2xsaXNpb25Ob3JtYWwueSAqIDUwMCwgX2V2ZW50LmNvbGxpc2lvbk5vcm1hbC56ICogNTAwKSwgX2V2ZW50LmNvbGxpc2lvblBvaW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhuZENvbGxpc2lvbkV2ZW50RXhpdChfZXZlbnQ6IGYuRXZlbnRQaHlzaWNzKTogdm9pZCB7XHJcbiAgICBpZiAoX2V2ZW50LmNtcFJpZ2lkYm9keS5nZXRDb250YWluZXIoKS5uYW1lID09IFwiUGxheWVyXCIpIHtcclxuICAgICAgZi5EZWJ1Zy5sb2coXCJQbGF5ZXIgbGVmdCBtZSAtIENvbGxpZGVyXCIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy9FdmVudCBmdW5jdGlvbiBoYW5kbGluZyB0cmlnZ2VyaW5nXHJcbiAgZnVuY3Rpb24gaG5kVHJpZ2dlckV2ZW50RW50ZXIoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcyk6IHZvaWQge1xyXG4gICAgaWYgKF9ldmVudC5jbXBSaWdpZGJvZHkuZ2V0Q29udGFpbmVyKCkubmFtZSA9PSBcIlBsYXllclwiKSB7XHJcbiAgICAgIGYuRGVidWcubG9nKFwiUGxheWVyIGVudGVyZWQgbWUgLSBUcmlnZ2VyXCIpO1xyXG4gICAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudE1hdGVyaWFsKS5tYXRlcmlhbCA9IHBsYXllclRyaWdnZXJlZE1hdDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGhuZFRyaWdnZXJFdmVudEV4aXQoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcyk6IHZvaWQge1xyXG4gICAgaWYgKF9ldmVudC5jbXBSaWdpZGJvZHkuZ2V0Q29udGFpbmVyKCkubmFtZSA9PSBcIlBsYXllclwiKSB7XHJcbiAgICAgIGYuRGVidWcubG9nKFwiUGxheWVyIGxlZnQgbWUgLSBUcmlnZ2VyXCIpO1xyXG4gICAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudE1hdGVyaWFsKS5tYXRlcmlhbCA9IHBsYXllckRlZmF1bHRNYXQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL1NpbmNlIHRoZSBwbGF5ZXIgY291bGQgZmFsbCBvZiB3ZSB3aWxsIHJlc2V0IGhpbSBiYWNrIHdpdGggYSB0cmlnZ2VyIHdoZW4gaGUgZmFsbHMgZG93biBmcm9tIHRoZSBwbGFuZVxyXG4gIGZ1bmN0aW9uIGhuZFJlc2V0VHJpZ2dlcihfZXZlbnQ6IGYuRXZlbnRQaHlzaWNzKTogdm9pZCB7XHJcbiAgICBpZiAoX2V2ZW50LmNtcFJpZ2lkYm9keS5nZXRDb250YWluZXIoKS5uYW1lID09IFwiUGxheWVyXCIpIHtcclxuICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLnNldFBvc2l0aW9uKG5ldyBmLlZlY3RvcjMoMCwgMywgMCkpOyAvL1NpbmNlIGl0J3MgYSBwaHlzaWNzIGJvZHkgd2UgaGF2ZSB0byBzZXQgcG9zaXRpb24gdGhyb3VnaCBwaHlzaWNzIG5vdCB0cmFuc2Zvcm1cclxuICAgIH1cclxuICB9XHJcblxyXG59Il19